---
title: Description of an test
categories:
- General
- External sources
feature_image: "https://picsum.photos/2560/600?image=872"
---

<!-- Output copied to clipboard! -->

<!-----

You have some errors, warnings, or alerts. If you are using reckless mode, turn it off to see inline alerts.
* ERRORs: 1
* WARNINGs: 0
* ALERTS: 21

Conversion time: 4.451 seconds.


Using this Markdown file:

1. Paste this output into your source file.
2. See the notes and action items below regarding this conversion run.
3. Check the rendered output (headings, lists, code blocks, tables) for proper
   formatting and use a linkchecker before you publish this page.

Conversion notes:

* Docs to Markdown version 1.0β34
* Tue Feb 14 2023 23:04:10 GMT-0800 (PST)
* Source doc: Deploying Unity Game Server Into Playfab Cloud

ERROR:
undefined internal link to this URL: "#heading=h.17dp8vu".link text: these steps
?Did you generate a TOC with blue links?

* This document has images: check for >>>>>  gd2md-html alert:  inline image link in generated source and store images to your server. NOTE: Images in exported zip file from Google Docs may not appear in  the same order as they do in your doc. Please check the images!

----->


<!-- Output copied to clipboard! -->

<!-- You have some errors, warnings, or alerts. If you are using reckless mode, turn it off to see inline alerts.
* ERRORs: 1
* WARNINGs: 0
* ALERTS: 21 -->


## Deploying Unity Game Server Into Playfab Cloud


#### Initial setup:


##### Prerequisites:



* Supports both Mirror and Fishnet
* Server is set up in a Linux container.
* Dev machine: Windows 10/11


##### Machine and Project Setup: (Windows 10/11)

lorem epseum testing the font size looks big to me tbh, lorem epseum testing the font size looks big to me tbhlorem epseum testing the font size looks big to me tbh Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. the font size looks big to me tbh Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. the font size looks big to me tbh Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.the font size looks big to me tbh Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. the font size looks big to me tbh Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.


* Enable WSL2 and install Ubuntu distro

    More info:  [Set up your Windows development device - PlayFab | Microsoft Docs](https://docs.microsoft.com/en-us/gaming/playfab/features/multiplayer/servers/deploying-linux-based-builds#set-up-your-windows-development-device)

* Install and setup Docker for wsl2 and make sure it’s running [Linux Containers](https://docs.docker.com/desktop/windows/#switch-between-windows-and-linux-containers)
* Add Linux Build support module to your Unity Engine Installation
* Access to the game’s [PlayFab developer account](https://developer.playfab.com/) and its docker _“Azure container registry”** **_credentials for a new build. 
* Make sure your project has [Unity C# SDKs for PlayFab](https://github.com/PlayFab/UnitySDK) and [UnityGsdk](https://github.com/PlayFab/gsdk/tree/main/UnityGsdk) (Playfab game server SDK for unity) setup and the api’s have already been integrated. (Sample [server script](https://github.com/PlayFab/MpsSamples/blob/main/UnityMirror/UnityServer/Assets/Server/Scripts/AgentListener.cs) & [client script](https://github.com/natepac/playfabmirrorgameexample/blob/master/Assets/Scripts/ClientStartUp.cs))
* Setup either [mirror](https://assetstore.unity.com/packages/tools/network/mirror-129321) or [fishnet](https://assetstore.unity.com/packages/tools/network/fish-net-networking-evolved-207815) in the project, and add their network managers into the scene


##### Network Manager Setup for Mirror:



* Create a new custom network manager as a inherited child class of mirrors network manager and add the KCP transport component into the same gameobject, which inturn uses UDP protocol
* Add a simple switch in the custom network manager like in the below image and set up all other necessary events like OnClientJoined etc in the script.

    
![alt_text](images/image1.png "image_tooltip")


* Add server and client listener scripts as child of the network manager gameobject


##### Network Manager Setup for Fishnet:



* Create a new custom network manager script, similar to the above mirror one.
* Add fishnet’s network manager as the child of the above gameobject along with it’s tugboat transport component

    
![alt_text](images/image2.png "image_tooltip")

![alt_text](images/image3.png "image_tooltip")

![alt_text](images/image4.png "image_tooltip")


* Add server and client listener scripts for playfab as child of custom network manager gameobject


#### Build and Deploy:


##### Building the headless server:



* Switch to **Dedicated-Server** Build mode and Select** Linux** as Target Platform

    
![alt_text](images/image5.png "image_tooltip")


* In Custom networkManager, switch Build type to **REMOTE_SERVER**

    _(which in turn enables the agent-listener script)_


    
![alt_text](images/image6.png "image_tooltip")


* **Build **the game and once build complete, create **docker file** in the build’s **parent **directory 

    [Create a Dockerfile - PlayFab | Microsoft Docs](https://docs.microsoft.com/en-us/gaming/playfab/features/multiplayer/servers/deploying-linux-based-builds#create-a-dockerfile)


    Directory and file should look something like the below image and the parent directory shouldn’t have any other files/directories except the dockerfile and game directory 


    (Note: Exclude the “_ServerX_BurstDebugInformation_DoNotShip” _Directory before creating the docker image of build folder.)


    
![alt_text](images/image7.png "image_tooltip")

![alt_text](images/image8.png "image_tooltip")




##### Creating and Deploying the Docker Image:



    * Copy the Docker Creds from [PlayFab developer account](https://developer.playfab.com/)

            
![alt_text](images/image9.png "image_tooltip")

![alt_text](images/image10.png "image_tooltip")




    * In your windows machine, open the ubuntu terminal (not windows cmd), 
    * move to the directory which contains the previously created Dockerfile, 

    _example: cd mnt/c/Code/Kevuru/battle-axes/Builds/server5/_

    * run the login command 

    _example: docker login -u &lt;username_here> -p &lt;password_here> &lt;url_here>_

* run the build docker image command

    _example: docker build -t &lt;url_here>/battleaxes_server:v1 .  _


    _(Note: there is a “.” in the end of above command which means all files in the directory)_


    _(Note: increment v1 (vX) based on previously uploaded version)_

* Now **before pushing** this image to the cloud, **test it locally** by following [these steps](#heading=h.17dp8vu).
* run the push docker build to cloud command

    _example: docker push &lt;url_here>/battleaxes_server:v1_



#### Testing the headless server:


##### Testing locally using playfab’s MpsLocalAgent:



* Download the localAgent that’s required for testing playfab builds locally

    url: [Releases · PlayFab/MpsAgent · GitHub](https://github.com/PlayFab/MpsAgent/releases)

* Setup the **MultiplayerSettings.json **file in the downloaded directory

    more_info: [Debug Container-based game servers using LocalMultiplayerAgent | Microsoft Docs](https://docs.microsoft.com/en-us/gaming/playfab/features/multiplayer/servers/localmultiplayeragent/run-container-gameserver#configure-multiplayersettingsjson)


**	**The file should look like something this in the end:

	
![alt_text](images/image11.png "image_tooltip")




* Now open windows terminal in the downloaded directory and run command:

    ```
    .\LocalMultiplayerAgent.exe -lcow

    ```


	_(Note: lcow stands for Linux Containers On Windows)_



* Once the local server goes to “active”, connect a local client with **ip: 127.0.0.1 and port 56100**


##### Using SSH into running cloud server:



* Click on “Connect to Virtual Machine” in builds of playfab developer console
* Open your windows terminal and Run the ssh command

    _example: ssh &lt;id_here>@&lt;ip_here> -p &lt;port_here>_

* Run the Docker ps to get current running container info

    _example: sudo docker ps -a_

* Get current server logs by cmd:

    sudo docker logs &lt;docker_container_id>



##### Testing locally using ParrelSync and three Unity editor instances:



* Setup ParrelSync in the project

    [GitHub - VeriorPies/ParrelSync: (Unity3D) Test multiplayer without building](https://github.com/VeriorPies/ParrelSync)

* Have three editor instance running, one will be playfab_server and the other two will be playfab_clients (not local clients), 
* Join the server from other clients using the default local host ip address (0.0.0.0) and default local port.


##### Common issues:



* If you get an error called:_ “You must set PlayFabSettings.TitleId before making API Calls.”_ you can get the title id from playfab developer console. 

    
![alt_text](images/image12.png "image_tooltip")


* If you get this error “network playfab not found”
![alt_text](images/image13.png "image_tooltip")
 \
Open “**SetupLinuxContainersOnWindows.ps1**” in LocalMultiplayerAgentPublish you just downloaded and run this “docker network create playfab --driver bridge”  in your linux distribution .


#### Connecting to our playfab game server as client:


##### Client Build Setup:



* Switch back to whatever target platform you were previously in from the dedicated server platform.
* In Custom networkManager, switch Build type to **PLAYFAB_CLIENT**

    _(which in turn enables the client-startup script)_


    
![alt_text](images/image14.png "image_tooltip")


* In the playfab dashboard, click on the “request server”, when you have standby servers, and then Get the **ip address**, **port** and **build id** from the playfab console on the website.

    
![alt_text](images/image15.png "image_tooltip")

![alt_text](images/image16.png "image_tooltip")


* Make sure you have the right **build-id, ipaddress, port **and **region** set in the custom network manager or the network manager script and save scene for all clients

    
![alt_text](images/image17.png "image_tooltip")


* Now with server already running, Click on **Start game** from **clients in UnityEditor**, and this should connect them all together.

    
![alt_text](images/image18.png "image_tooltip")


* Now open a second client and click on “**Join Game**” button, enter the configuration you received above

    
![alt_text](images/image19.png "image_tooltip")




#### Multiple instances:


##### Inspecting multiple instances in same VM:



* Containers use “playfab” network plugins, to inspect the instances in the machine run:

    docker inspect network playfab

* More details: [Connecting clients to game servers - PlayFab | Microsoft Learn](https://learn.microsoft.com/en-us/gaming/playfab/features/multiplayer/servers/connecting-clients-to-game-servers)

    
![alt_text](images/image20.png "image_tooltip")

